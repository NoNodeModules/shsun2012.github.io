---
layout: post
title: "PCA in R"
subtitle: "Notes"
author: "Shsun"
header-style: text
tags:
  - Blog
---
The fundamentals of PCA have been discussed over and over again. The aim of PCA is to create a new set of uncorrelated variables that are a linear combination of the initial variables and explain as much of the initial variation as possible. When analysing meteorological variables, we always use PCA/EOF to extract the uncorrelated principal components as original meteorolgical factors are usually correlated with each other. Some variables I used most recently are shown this plot:![PCA](/img/pca.png)


#### PC regression analysis example
Here is some codes in R for PCA analysis:
```
pca = prcomp(~X.data, scale=normalized, na.action=na.exclude)
PC.sd = pca$sdev
PC.rot = pca$rotation
PC.data = pca$x
pca.var.per = round(pca.var/sum(pca.var)*100, 1)  # shsun
OUTPUT = list(date=date.vec, X.mean=X.mean, X.sd=X.sd, var.name=var.name, PC.sd=PC.sd, PC.rot=PC.rot, PC.data=PC.data, pca = pca)

PC.reg = lm(Y.n ~ -1 + PC1 + PC2 + PC3 + PC4, na.action = na.exclude)
mlr.forward(y = Y.n, X = PCA$PC.data)

```
By default, `prcomp()` expects samples (observations) to be rows and the variables to be columns. returns `x`, `sdev`, and `rotation`. **x** contains the PCs for grawing a graph. `plot(pca$x[,1], pca$x[,2])` can be used to plot for the first two PCs. The x and y axis tells about he percentage of the variatioin in the original data that PC1 and PC2 account for. `pca$rotation` record loading scores for each PC. Loading scores can be used to determine which variables have the largest effects. `pca$rotation[,1]` is the loading scores for PC1.

#### Application
Currently I am analysing meteorological impacts on stomatal conductance as well as how these interactions would affect surface ozone contrations. Previously I listed many variables and tried to find the patterns. An example for PCA: using MERRA2 meteorology and surface ozone concentrations to analyse meteorology impacts on ozone in US. Following steps:
1. Calculate the moving average of meteorological variables and get the deseasonalized daily values.
2. Calculate the correlations between ozone and meteorology.
3. Calculate PCA for each grid
4. Plot maps of PC





##### Reference
1. [Principal component analysis: a review and recent developments](https://royalsocietypublishing.org/doi/10.1098/rsta.2015.0202)
2. [StatQuest with Josh Starmer](https://www.youtube.com/watch?v=0Jp4gsfOLMs)
